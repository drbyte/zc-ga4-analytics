<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GA4 Analytics for Zen Cart 1.5.7 and Later</title>
<style type="text/css">
a, a:active, 
a:visited { 
    color: #006666; 
}
a:hover { 
    color:#00CC99; 
}
body, 
p, 
h1, 
h2, 
h3, 
h4, 
li, 
td { 
    font-family: Verdana, AvantGarde, Tahoma, Arial, sans-serif; 
    font-size: 10pt; 
    color: black; 
    padding: 0px; 
    margin: 20px; 
}
pre { 
    margin: 20px; 
}
H1, 
H2, 
H3, 
H4 { 
    font-weight: bold 
}
h1 { 
    font-size: 20px; 
}
h2 { 
    font-size: 16px; 
    border-top: 1px solid black;
    padding-top: 5px;
}
ol li, 
ul li { 
    margin: 5px 0; 
}
.corefile, 
.impt { 
    color: red; 
}
.added { 
    color: blue; 
}
img { 
    margin-left: 20px; 
    max-width: 95%; 
}
.removed { 
    text-decoration: line-through; 
}
.smaller {
    font-size: smaller;
}
table {
    margin-left: 20px;
}
table, table th, table td {
    padding: 0.5rem;
    border-collapse: collapse;
    border: 1px solid black;
}
th, td {
    text-align: left;
}
table table {
    margin-top: 0.5rem;
}
.event-group {
    text-transform: uppercase;
    border-top: 1px solid black;
    padding-top: 0.5rem;
}
</style>
</head>

<body>
    <h1>GA4 Analytics for Zen Cart v1.5.6b and later, including v1.5.8</h1>
    <h3>Version 1.0.0</h3>
    <p>Current Support Thread at Zen Cart Forums: <a href="javascript:void();" target="_blank">TBD</a></p>
    <p>Zen Cart Download Link: <a href="javascript:void();" target="_blank">TBD</a></p>
    <p>GitHub repository: <a href="https://github.com/lat9/ga4-analytics" target="_blank">https://github.com/lat9/ga4-analytics</a>.</p>

    <p><b>IMPORTANT NOTICE:</b></p>
    <hr>
    <p>This plugin is a standalone solution for GA4 Analytics meant to replace <b>all other</b> Zen Cart plugins you might use right now. Do <b>not</b> use any other Google Analytics plugins (like &quot;Simple Google Analytics&quot;, &quot;Easy Google Analytics&quot; or even the <em>legacy</em> &quot;EC Analytics&quot;) together with this plugin.
    <ul>
        <li>Make sure that you uninstall any other Google Analytics plugins before you install this plugin.</li>
        <li>Make sure that you did <b>not</b> add some Google tracking scripts anywhere manually in your Zen Cart files.</li>
        <li>Make sure that you do <b>not</b> add additional Adwords conversion tracking codes/scripts anywhere in your store.</li>
        <li>If you are using Adwords campaigns make sure that your Google Analytics account is linked with your Google Adwords account.</li>
    </ul>
    <p><b>Note:</b> The initial version of this plugin <em>does not <b>fully</b> support</em> <a href="https://www.zen-cart.com/downloads.php?do=file&id=2095" target="_blank">One-Page Checkout</a>.  Specifically, the <a href="#checkout">checkout-related</a> <code>add_shipping_info</code> and <code>add_payment_info</code> events will not be reported.  The <code>purchase</code> events will be reported regardless of the checkout processing your store uses.</p>

    <h2>Credits</h2>
    <p>This plugin is based on the <a href="https://www.zen-cart.com/downloads.php?do=file&id=1997" target="_blank">EC Analytics</a> Zen Cart plugin, provided by @RodG and @webchills.</p>

    <h2>Purpose</h2>
    <p>This module utilizes the <em>Google Analytics 4</em> API, based on that API's documentation as of December 2022. It records all of your store sales data for viewing from your Google Analytics Account (which must be created before installing this module).  You'll need to create your site's &quot;GA4 Measuring ID&quot; (e.g. <code>G-xxxxxxxx</code>) before the plugin will start its measurements.  Refer to <a href="https://support.google.com/analytics/answer/10089681?utm_source=developers.google.com&utm_medium=referral" target="_blank">this</a> GA4 documentation link for additional information.</p>

    <h2>Installation and Upgrade</h2>
    <p><b>Before you start &hellip;</b></p>
    <ol>
        <li>Edit your current template's version of <code>/common/html_header.php</code> and add a notification that <em>GA4 Analytics</em> requires to insert the load of the <code>gtag.js</code> module, right after the &lt;head&gt; tag:<pre>
  &lt;head&gt;
&lt;?php
// -----
// Provide a notification that the <head> tag has been rendered for the current page.
//
$zco_notifier-&gt;notify('NOTIFY_HTML_HEAD_TAG_START', $current_page_base);
?&gt;
        </pre></li>
        <li>Ensure that your current template's version of <code>/common/tpl_main_page.php</code> contains the following notification, prior to the &lt;/body&gt; tag.  It's OK if that notification is present in the page's &quot;mainWrapper&quot; <code>div</code>:<pre>
&lt;?php /* add any end-of-page code via an observer class */
$zco_notifier-&gt;notify('NOTIFY_FOOTER_END', $current_page);
?&gt;
        </pre></li>
        <li><b>If your store runs on Zen Cart 1.5.6b or 1.5.6c</b>, you'll need to edit your version of <code>/includes/classes/shopping_cart.php</code>.  Find the <b>NOTIFIER_CART_ADD_CART_END</b> notification and change it to add the parameters that were added in Zen Cart 1.5.7:<pre>
$this-&gt;notify('NOTIFIER_CART_ADD_CART_END'<b>, array(), $products_id, $qty, $attributes, $notify</b>);
        </pre></li>
    </ol>
    <ol>
        <li>Unzip this distribution's zip-file; you'll see the following files and directories:<ol type="a">
            <li>/includes/auto_loaders/config.ga4_analytics.php</li>
            <li>/includes/classes/observers/class.ga4_analytics.php</li>
            <li>/includes/extra_cart_actions/ga4_analytics_actions.php</li>
            <li>/includes/languages/english/extra_definitions/ga4_analytics_extra_definitions.php</li>
            <li>/includes/templates/template_default/jscript/ga4_analytics_events_script.php</li>
            <li>/includes/templates/template_default/jscript/ga4_analytics_start_script.php</li>
            <li>/YOUR_ADMIN/includes/auto_loaders/config.ga4_analytics_admin.php</li>
            <li>/YOUR_ADMIN/includes/init_includes/init_ga4_analytics_admin.php</li>
            <li>/YOUR_ADMIN/includes/languages/english/extra_definitions/ga4_analytics_admin_names.php</li>
        </ol></li>
        <li>Rename the <code>YOUR_ADMIN</code> sub-directory to match your site's Zen Cart admin directory.</li>
        <li>Copy the plugin's files to your site's file-system.</li>
        <li>Log into your Zen Cart admin and the plugin will perform its auto-install procedure.</li>
        <li>You'll see a <em>GA4 Analytics Settings</em> element under the admin's <em>Configuration</em> tab; proceed to the configuration step, see below.</li>
    </ol>

    <h2 id="config">Configuration</h2>
    <p>The plugin adds its <em>GA4 Analytics Settings</em> group under the admin's <em>Configuration</em>, providing these configuration settings:</p>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Plugin Version</td>
                <td>The <em>GA4 Analytics</em> installed version.</td>
            </tr>
            <tr>
                <td>GA4 Analytics Measuring ID</td>
                <td>Enter the GA4 Analytics <em>Measuring ID</em> provided to you when you registered your site with google.  That ID will start with <code>G-</code>.  Set this value to an empty string (the default) to disable the <em>GA4 Analytics</em> plugin.</td>
            </tr>
            <tr id="variant-separator">
                <td>Product Variants' Separator</td>
                <td>If your store has products with multiple attributes, identify the character-string to use as a separator for an attributed product's <code>item_variant</code> property.  Default: <code>|</code>.</td>
            </tr>
            <tr>
                <td>Enable Debug Mode?</td>
                <td>Should <b>all</b> GA4 events be sent in <code>debug_mode</code>?  This can be used to help you debug your GA4 installation.  Default: <b>false</b>.</td>
            </tr>
        </tbody>
    </table>

    <h2>GA4 Events Measured</h2>
    <p>This section identifies the <em>GA4/gtag</em> events monitored by this plugin; see <a href="https://developers.google.com/analytics/devguides/collection/ga4/reference/events?client_type=gtag" target="_blank">this</a> Google documentation for the supported events and their basic parameters.</p>
    <p><b>Notes:</b></p>
    <ol>
        <li>One-time charges for products' pricing are <em>not</em> included (other than an order or cart event that includes an overall price).  There is no provision within the GA4 event schema to include those values on an individual product basis.</li>
        <li>If a customer is currently logged-in (and not in guest-checkout), the <code>gtag('config', ...);</code> event includes the <em>user_id</em> parameter, set to the logged-in customer's <code>customers_id</code>.  See <a href="https://developers.google.com/analytics/devguides/collection/ga4/user-id/?platform=websites" target="_blank">this</a> GA4 documentation link for additional details.</li>
    </ol>

    <h3 class="event-group">Product-view Events</h3>
    <h4 id="product-common">Common Product View Event Parameters</h4>
    <p>These parameters are provided for the product-view (either listings or an individual product) events:</p>
    <table>
        <thead>
            <tr>
                <th>Parameter Name</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>items</td>
                <td>A numerically-indexed array of items/products associated with the event:<table>
                    <thead>
                        <tr>
                            <th>Parameter Name</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>item_name</td>
                            <td>The name of the product.</td>
                        </tr>
                        <tr>
                            <td>quantity</td>
                            <td>Always set to 1.</td>
                        </tr>
                        <tr>
                            <td>price</td>
                            <td>The product's per-unit price.</td>
                        </tr>
                        <tr>
                            <td>item_id</td>
                            <td>Contains the product's model-number, so long as that value isn't blank.</td>
                        </tr>
                        <tr>
                            <td>brand</td>
                            <td>The name of the product's brand, aka manufacturer, so long as a manufacturer has been defined for the product.</td>
                        </tr>
                        <tr>
                            <td>item_category</td>
                            <td>The name of the product's current first-level category name.</td>
                        </tr>
                        <tr>
                            <td>item_category<code>2-5</code></td>
                            <td>The name of the product's sub-category names, up to 5 levels deep.</td>
                        </tr>
                        <tr>
                            <td>item_variant</td>
                            <td>If the product has attributes, contains a string containing the options' names (separated by the <a href="#variant-separator">Variant Separator</a>).  Note that text- and file-type attributes are not included.</td>
                        </tr>
                    </tbody>
                </table></td>
            </tr>
        </tbody>
    </table>
    <h4>view_item</h4>
    <p>This event is sent at the end of a product's detailed-view page, e.g. <code>product_info</code> page's rendering.  In addition to the <a href="#product-common">Common Product View Event Parameters</a>, this event includes:</p>
    <table>
        <thead>
            <tr>
                <th>Parameter Name</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>currency</td>
                <td>A copy of the <code>$_SESSION['currency']</code>, e.g. <code>USD</code>.</td>
            </tr>
            <tr>
                <td>value</td>
                <td>The item's current price.</td>
            </tr>
        </tbody>
    </table>
    <h4>view_item_list</h4>
    <p>This event is sent on various product-listing pages (<code>specials</code>, <code>products_new</code>, <code>products_all</code>, <code>featured_products</code> as well as the category-based products' listings.  In addition to the <a href="#product-common">Common Product View Event Parameters</a>, this event includes:</p>
    <table>
        <thead>
            <tr>
                <th>Parameter Name</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>item_list_name</td>
                <td>Set to a language constant, defined in <code>/includes/languages/english/extra_definitions/ga4_analytics_extra_definitions.php</code>, that identifies the type of listing being viewed.</td>
            </tr>
        </tbody>
    </table>

    <h3 class="event-group">Cart-related Events</h3>
    <h4 id="cart-common">Common Cart Event Parameters</h4>
    <p>These parameters are provided for <b>all</b> the cart-related events, gathered via the <code>shopping_cart</code> class' <code>get_products</code> method:</p>
    <table>
        <thead>
            <tr>
                <th>Parameter Name</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>currency</td>
                <td>The current value of <code>$_SESSION['currency']</code>, e.g. <code>USD</code>.</td>
            </tr>
            <tr>
                <td>value</td>
                <td>The overall value associated with the event, converted to a 2-decimal numeric value.</td>
            </tr>
            <tr>
                <td>items</td>
                <td>A numerically-indexed array of items/products associated with the event:<table>
                    <thead>
                        <tr>
                            <th>Parameter Name</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>item_name</td>
                            <td>The name of the product.</td>
                        </tr>
                        <tr>
                            <td>quantity</td>
                            <td>The product quantity associated with the event, e.g. the quantity added or removed.</td>
                        </tr>
                        <tr>
                            <td>price</td>
                            <td>The product's per-unit price.</td>
                        </tr>
                        <tr>
                            <td>item_id</td>
                            <td>Contains the product's model-number, so long as that value isn't blank.</td>
                        </tr>
                        <tr>
                            <td>brand</td>
                            <td>The name of the product's brand, aka manufacturer, so long as a manufacturer has been defined for the product.</td>
                        </tr>
                        <tr>
                            <td>item_category</td>
                            <td>The name of the product's current first-level category name.</td>
                        </tr>
                        <tr>
                            <td>item_category<code>2-5</code></td>
                            <td>The name of the product's sub-category names, up to 5 levels deep.</td>
                        </tr>
                        <tr>
                            <td>item_variant</td>
                            <td>If the product has attributes, contains a string containing the options' name and the option's value name (separated by the <a href="#variant-separator">Variant Separator</a>).  Note that text- and file-type attributes are not included.</td>
                        </tr>
                    </tbody>
                </table></td>
            </tr>
        </tbody>
    </table>
    <h4>view_cart</h4>
    <p>This event is sent at the end of the <code>shopping_cart</code> page's rendering, so long as the cart is not empty.  The overall <code>value</code> parameter reflects the cart's current value.</p>
    <h4>add_to_cart</h4>
    <p>This event is sent whenever a product is added to the cart, which can occur under various conditions:</p>
    <ol>
        <li>From a products' listing page.</li>
        <li>From a product's detailed information page.</li>
        <li>Upon customer login, when previously-stored items in the <code>customers_basket</code> are added.</li>
        <li>From the <code>shopping_cart</code> page, when a current product's quantity is increased.</li>
    </ol>
    <h4>remove_from_cart</h4>
    <p>This event is sent whenever a product is removed from the cart, which can occur under various conditions:</p>
    <ol>
        <li>From the <code>shopping_cart</code> page, when a current product's quantity is decreased.</li>
        <li>From the <code>shopping_cart</code> page, when a current product is removed.</li>
        <li>When the <code>shopping_cart</code> class receives a request to <code>remove_all</code> products from the cart.</li>
    </ol>

    <h3 id="checkout" class="event-group">Checkout-related Events</h3>
    <h4 id="checkout-common">Common Checkout Parameters</h4>
    <p>Some parameters are common to <b>all</b> the checkout-related events:</p>
    <table>
        <thead>
            <tr>
                <th>Parameter Name</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>currency</td>
                <td>The current value of <code>$_SESSION['currency']</code>, e.g. <code>USD</code>.</td>
            </tr>
            <tr>
                <td>value</td>
                <td>The order's overall value, <code>$order->info['total']</code>, converted to a 2-decimal numeric value.</td>
            </tr>
            <tr>
                <td>coupon</td>
                <td>If the order is currently being processed with a coupon, e.g. <code>$_SESSION['cc_id']</code> is set, this parameter is present and set to the <code>coupon_code</code> of the current coupon.</td>
            </tr>
            <tr>
                <td>items</td>
                <td>A numerically-indexed array of items/products in the order:<table>
                    <thead>
                        <tr>
                            <th>Parameter Name</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>item_name</td>
                            <td>The name of the product, as recorded in the order.</td>
                        </tr>
                        <tr>
                            <td>currency</td>
                            <td>The current value of <code>$_SESSION['currency']</code>, e.g. <code>USD</code>.</td>
                        </tr>
                        <tr>
                            <td>quantity</td>
                            <td>The quantity of the product ordered, as recorded in the order.</td>
                        </tr>
                        <tr>
                            <td>price</td>
                            <td>The product's per-unit price, as recorded in the order's <code>final_price</code> for the product.</td>
                        </tr>
                        <tr>
                            <td>item_id</td>
                            <td>Contains the product's model-number, as recorded in the order, so long as that value isn't blank.</td>
                        </tr>
                        <tr>
                            <td>brand</td>
                            <td>The name of the product's brand, aka manufacturer, so long as a manufacturer has been defined for the product.</td>
                        </tr>
                        <tr>
                            <td>item_category</td>
                            <td>The name of the product's current first-level category name.</td>
                        </tr>
                        <tr>
                            <td>item_category<code>2-5</code></td>
                            <td>The name of the product's sub-category names, up to 5 levels deep.</td>
                        </tr>
                        <tr>
                            <td>item_variant</td>
                            <td>If the product has attributes, contains a string containing the options' name and the option's value name (separated by the <a href="#variant-separator">Variant Separator</a>).  Note that text- and file-type attributes are not included.</td>
                        </tr>
                    </tbody>
                </table></td>
            </tr>
        </tbody>
    </table>
    <h4>begin_checkout</h4>
    <p>If the order contains physical products, this event is sent at the end of the <code>checkout_shipping</code> page's rendering; otherwise, it is sent at the end of the <code>checkout_payment</code> page's rendering, so long as the <code>checkout_confirmation</code> page <em>was <b>not</b></em> its referrer. The event includes only the parameters identified in <a href="#checkout-common">Common Checkout Parameters</a>.</p>
    <h4>add_shipping_info</h4>
    <p>This event is sent at the end of the <code>checkout_payment</code> page's rendering, so long as the <code>checkout_confirmation</code> page <em>was <b>not</b></em> its referrer.  In addition to the <a href="#checkout-common">Common Checkout Parameters</a>, this event includes:</p>
    <table>
        <thead>
            <tr>
                <th>Parameter Name</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>shipping_tier</td>
                <td>The currently-selected shipping method, as recorded in the order's <code>info['shipping_method']</code>, e.g. <code>Store Pickup (Walk In)</code>.</td>
            </tr>
        </tbody>
    </table>
    <h4>add_payment_info</h4>
    <p>This event is sent at the end of the <code>checkout_confirmation</code> page's rendering, so long as the <code>checkout_payment</code> page was its referrer.  In addition to the <a href="#checkout-common">Common Checkout Parameters</a>, this event includes:</p>
    <table>
        <thead>
            <tr>
                <th>Parameter Name</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>payment_type</td>
                <td>The currently-selected payment type, as recorded in <code>$_SESSION['payment']</code>, e.g. <code>moneyorder</code>.</td>
            </tr>
        </tbody>
    </table>
    <h4>purchase</h4>
    <p>This event is sent at the end of the <code>checkout_success</code> page's <b>first</b> rendering of the just-placed order, i.e. the <code>$order_summary</code> value is not empty.  In addition to the <a href="#checkout-common">Common Checkout Parameters</a>, this event includes:</p>
    <table>
        <thead>
            <tr>
                <th>Parameter Name</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>transaction_id</td>
                <td>The just-placed order's <code>orders_id</code>.</td>
            </tr>
            <tr>
                <td>shipping</td>
                <td>The portion of the order's <code>value</code> that reflects the order's shipping cost.</td>
            </tr>
            <tr>
                <td>tax</td>
                <td>The portion of the order's <code>value</code> that reflects the order's tax.</td>
            </tr>
        </tbody>
    </table>

    <h3 class="event-group">Other Events</h3>
    <h4>login</h4>
    <p>This event is sent upon a successful customer login, including the following parameter list:</p>
    <table>
        <thead>
            <tr>
                <th>Parameter Name</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>method</td>
                <td>Set to either <code>normal</code>, on a returning customer's login, or <code>create_account</code>, if the login was the result of a customer's successful account-creation.</td>
            </tr>
        </tbody>
    </table>
    <h4>sign_up</h4>
    <p>This event is sent when a customer successfully creates an account; no additional parameters are included.</p>
    <h4>search</h4>
    <p>This event is sent at the end of a search-results' page's header, including the following parameter list:</p>
    <table>
        <thead>
            <tr>
                <th>Parameter Name</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>search_term</td>
                <td>Set to the &quot;keywords&quot; for which the customer has searched.</td>
            </tr>
        </tbody>
    </table>

    <h2>Version History</h2>
    <p>These sections identify the GA4 Analytics changes as well as the change-history associated with the EC Analytics plugin, on which it's based.</p>
    <h3>GA4 Analytics Version History</h3>
    <ul>
        <li>v1.0.0, 2022-12-12 (lat9)<ul>
            <li>&quot;Measuring ID&quot; is stored in the database; See <em>Configuration :: GA4 Analytics Settings</em></li>
            <li>Include <em>all</em> product types for the <code>view_item</code> event; was only <code>product_info</code>.</li>
        </ul></li>
    </ul>

    <h3>EC Analytics Version History (Legacy)</h3>
    <ul>
        <li>v1.2.2, 2017-12-12 (DrByte, webchills)<ul>
            <li>Updated code for PHP7 compatibility.</li>
        </ul></li>
        <li>v1.2.1, 2017-12-11 (webchills)<ul>
            <li>Fix typo preventing the brand name to be recorded see: https://www.zen-cart.com/showthread.php?217086-Google-Ecommerce-Tracking&p=1339193#post1339193.</li>
        </ul></li>
        <li>v1.2.0, 2017-05-18 (webchills)<ul>
            <li>Fixes suggested in the following thread integrated: https://www.zen-cart.com/showthread.php?217086-Google-Ecommerce-Tracking/.</li>
            <li>Some unnecessary code removed.</li>
            <li>readme updated</li>
        </ul></li>
        <li>v1.0.1, 2015-05-13 (RodG)<ul>
            <li>Initial release.</li>
        </ul></li>
    </ul>

</body>
</html>